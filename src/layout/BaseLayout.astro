---
// src/layout/BaseLayout.astro
import { Header } from '../components/Header.tsx';
import { Footer } from '../components/Footer.tsx';

---

<html lang="it">
  <head>
    </head>
  <body>

    <main class="pt-16">
      <Header client:load />
      <slot /> 
    </main>
    
    <script>
      import { activeSection } from '../stores/navigationStore';

      // Seleziona tutte le sezioni figlie di <main> che hanno un ID
      const sections = document.querySelectorAll('main section[id]');

      if (sections.length > 0) {
        const observer = new IntersectionObserver((entries) => {
          for (const entry of entries) {
            if (entry.isIntersecting) {
              // Appena una sezione entra nel viewport, 
              // aggiorna lo store globale.
              activeSection.set(entry.target.id);
              break; // Ci interessa solo la prima che intercetta
            }
          }
        }, {
          // 'rootMargin' imposta la "linea" di trigger.
          // -160px dall'alto, -30% dal basso.
          // Regola questi valori per perfezionare quando si attiva il link.
          rootMargin: '-160px 0px -30% 0px',
          threshold: 0 // Si attiva appena 1px Ã¨ visibile
        });

        sections.forEach((section) => {
          observer.observe(section);
        });
      }
    </script>
  </body>
  <footer>
    <Footer client:load />
  </footer>
</html>